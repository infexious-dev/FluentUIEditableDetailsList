# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- main

variables:
  packageName: FluentUIEditableDetailsList

pool:
  vmImage: windows-latest

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '16.19.0'
    displayName: 'Install Node.js'
  - task: Npm@1
    displayName: 'npm custom'
    inputs:
      command: custom
      verbose: false
      customCommand: 'install --production'
  # Upload module to pipeline for next stage
  - publish: 'out'
    artifact: '${{ variables.packageName }}'
    displayName: 'Publish artifact'
  - task: npmAuthenticate@0
    inputs:
      workingFile: $(Build.SourcesDirectory)/.npmrc
    displayName: Authenticate to Azure Artifacts
   # NPM Publish - create tarball and publish to NPM registry in Azure Dev Ops          
  - task: Npm@1
    displayName: Create and publish npm package
    inputs:
      command: publish
      workingDir: 'out'
      verbose: true
      publishRegistry: useFeed
      publishFeed: 'e1878607-e070-43ae-bad2-64522806ece5'
  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: drop'